(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[596],{415:(t,e,n)=>{"use strict";n.d(e,{hS:()=>u});var i=n(5242);function a(t){return"object"==typeof t&&null!==t&&"request"in t}async function u(){let t=function(){let t=function(){let{ethereum:t}=window;if(!t)return null;if(Array.isArray(t.providers)){let e=t.providers.find(t=>null==t?void 0:t.isMetaMask);if(e&&a(e))return e}return t.isMetaMask&&a(t)||a(t)?t:null}();if(!t)throw Error("未检测到 MetaMask，请安装或启用 MetaMask 扩展");return new i.k(t)}();return await t.send("eth_requestAccounts",[]),await t.getSigner()}},3346:(t,e,n)=>{"use strict";n.d(e,{wP:()=>s});var i=n(8678),a=n(5704);let u=[{type:"function",name:"getAllownance",stateMutability:"view",inputs:[{name:"user",type:"address"}],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"getFrozenAllowance",stateMutability:"view",inputs:[{name:"user",type:"address"}],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"getTrade",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"seller",type:"address"},{name:"sellAmount",type:"uint256"},{name:"startTimeStamp",type:"uint256"},{name:"endTimeStamp",type:"uint256"},{name:"minimumBidAmount",type:"uint256"},{name:"initPriceOfUint",type:"uint256"}]},{type:"function",name:"getTradeDeposit",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"getAuctionAmount",stateMutability:"view",inputs:[],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"startTrade",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"amount",type:"uint256"},{name:"startTimeStamp",type:"uint256"},{name:"endTimeStamp",type:"uint256"},{name:"minimumBidAmount",type:"uint256"},{name:"initPriceOfUint",type:"uint256"}],outputs:[]},{type:"function",name:"deposit",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"amount",type:"uint256"},{name:"info",type:"string"}],outputs:[]},{type:"function",name:"refundDeposit",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"}],outputs:[]},{type:"function",name:"setBidInfo",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"info",type:"string"}],outputs:[]},{type:"function",name:"setBidSecret",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"secret",type:"string"}],outputs:[]},{type:"function",name:"getBidInfo",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"",type:"string"}]},{type:"function",name:"getBidSecret",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"",type:"string"}]},{type:"function",name:"finalizeAuctionAndTransferCarbon",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"allowanceAmount",type:"uint256"},{name:"additionalAmountToPay",type:"uint256"}],outputs:[]},{type:"function",name:"withdrawAuctionAmount",stateMutability:"nonpayable",inputs:[],outputs:[]}];function s(t){return new i.NZ(function(){let t=a.env.NEXT_PUBLIC_CONTRACT_ADDRESS;if(!t)throw Error("NEXT_PUBLIC_CONTRACT_ADDRESS 未配置");return t}(),u,t)}},4039:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>p});var i=n(5155),a=n(2115),u=n(6096),s=n(3346),r=n(415);function p(){let[t,e]=(0,a.useState)(""),[n,p]=(0,a.useState)(""),[m,c]=(0,a.useState)(""),[f,g]=(0,a.useState)(!1),[b,w]=(0,a.useState)("");async function h(e){e.preventDefault(),w("");try{g(!0);let e=await (0,r.hS)(),i=(0,s.wP)(e),a=await i.deposit(t,u.Dg(n||"0"),m);await a.wait(),w("保证金已提交")}catch(t){w("object"==typeof t&&null!==t&&"message"in t?String(t.message):"提交失败")}finally{g(!1)}}async function v(){w("");try{g(!0);let e=await (0,r.hS)(),n=(0,s.wP)(e),i=await n.refundDeposit(t);await i.wait(),w("保证金已退回")}catch(t){w("object"==typeof t&&null!==t&&"message"in t?String(t.message):"退款失败")}finally{g(!1)}}return(0,i.jsxs)("div",{style:{padding:24,margin:"0 auto",maxWidth:720},children:[(0,i.jsx)("h2",{style:{fontSize:22,fontWeight:600},children:"参与竞拍"}),(0,i.jsxs)("form",{onSubmit:h,style:{marginTop:16,display:"grid",gap:12},children:[(0,i.jsx)(o,{label:"交易ID",children:(0,i.jsx)("input",{value:t,onChange:t=>e(t.target.value),required:!0,style:l})}),(0,i.jsx)(o,{label:"保证金",children:(0,i.jsx)("input",{type:"number",min:"0",value:n,onChange:t=>p(t.target.value),required:!0,style:l})}),(0,i.jsx)(o,{label:"投标信息（字符串）",children:(0,i.jsx)("input",{value:m,onChange:t=>c(t.target.value),style:l})}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,marginTop:4},children:[(0,i.jsx)("button",{disabled:f,style:y,children:f?"提交中...":"提交保证金"}),(0,i.jsx)("button",{type:"button",onClick:v,disabled:f,style:d,children:"退回保证金"})]}),b&&(0,i.jsx)("div",{style:{color:b.includes("已")?"#065f46":"#b91c1c"},children:b})]})]})}function o(t){let{label:e,children:n}=t;return(0,i.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,i.jsx)("span",{style:{fontSize:14,color:"#374151"},children:e}),n]})}let l={padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:8},y={padding:"10px 14px",background:"#0f766e",color:"#fff",borderRadius:8},d={padding:"10px 14px",background:"#fff",color:"#111827",border:"1px solid #e5e7eb",borderRadius:8}},7908:(t,e,n)=>{Promise.resolve().then(n.bind(n,4039))}},t=>{t.O(0,[242,441,255,358],()=>t(t.s=7908)),_N_E=t.O()}]);